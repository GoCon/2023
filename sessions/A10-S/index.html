<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><base href="/2023/"/><link rel="icon" href="/2023/favicon.ico"/><meta name="description" content="Go Conference is a conference for Go programming language users."/><meta property="og:site_name" content="Go Conference 2023"/><meta property="og:description" content="Go Conference is a conference for Go programming language users."/><meta property="og:type" content="website"/><meta property="og:url" content="https://gocon.jp/2023"/><meta property="og:image" content="https://gocon.jp/2023/ogp-thumbnail.png"/><meta name="twitter:card" content="summary_large_image"/><title>Go1.20からサポートされるtree構造のerrの紹介と、treeを考慮した複数マッチができるライブラリを作った話 | Go Conference 2023</title><meta property="og:title" content="Go1.20からサポートされるtree構造のerrの紹介と、treeを考慮した複数マッチができるライブラリを作った話"/><meta name="next-head-count" content="13"/><link rel="preload" href="/2023/_next/static/media/916d3686010a8de2-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/2023/_next/static/media/7777133e901cd5ed-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/2023/_next/static/media/d869208648ca5469-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/2023/_next/static/media/9a881e2ac07d406b-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/2023/_next/static/css/cbd62f3d07239dc3.css" as="style"/><link rel="stylesheet" href="/2023/_next/static/css/cbd62f3d07239dc3.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/2023/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/2023/_next/static/chunks/webpack-129c7a85e2ef217a.js" defer=""></script><script src="/2023/_next/static/chunks/framework-2c79e2a64abdb08b.js" defer=""></script><script src="/2023/_next/static/chunks/main-3f0e60bff2004706.js" defer=""></script><script src="/2023/_next/static/chunks/pages/_app-c34f950bb43e59ab.js" defer=""></script><script src="/2023/_next/static/chunks/fec483df-84b60e9b787738d5.js" defer=""></script><script src="/2023/_next/static/chunks/603-37e5a3a881648ed9.js" defer=""></script><script src="/2023/_next/static/chunks/504-9d1f18080c8aa555.js" defer=""></script><script src="/2023/_next/static/chunks/pages/sessions/%5Bid%5D-37aae00bce3d9025.js" defer=""></script><script src="/2023/_next/static/Pa456hInAa-dSv_O0Jk7e/_buildManifest.js" defer=""></script><script src="/2023/_next/static/Pa456hInAa-dSv_O0Jk7e/_ssgManifest.js" defer=""></script></head><body><div id="__next"><style data-emotion="css mdfyde">.css-mdfyde{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;width:100%;box-sizing:border-box;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;position:fixed;z-index:1100;top:0;left:auto;right:0;background-color:#1976d2;color:#fff;background-color:#fff0;height:100px;box-shadow:none;}@media print{.css-mdfyde{position:absolute;}}</style><style data-emotion="css 13r0ouy">.css-13r0ouy{background-color:#fff;color:rgba(0, 0, 0, 0.87);-webkit-transition:box-shadow 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:box-shadow 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;box-shadow:0px 2px 4px -1px rgba(0,0,0,0.2),0px 4px 5px 0px rgba(0,0,0,0.14),0px 1px 10px 0px rgba(0,0,0,0.12);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;width:100%;box-sizing:border-box;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;position:fixed;z-index:1100;top:0;left:auto;right:0;background-color:#1976d2;color:#fff;background-color:#fff0;height:100px;box-shadow:none;}@media print{.css-13r0ouy{position:absolute;}}</style><header class="MuiPaper-root MuiPaper-elevation MuiPaper-elevation4 MuiAppBar-root MuiAppBar-colorPrimary MuiAppBar-positionFixed mui-fixed css-13r0ouy"><style data-emotion="css 5w8nlu">.css-5w8nlu{-webkit-transition:200ms all linear;transition:200ms all linear;position:absolute;width:100%;height:128px;background:linear-gradient(180deg, #4E96E9 19.27%, rgba(77, 148, 230, 0) 88.54%);opacity:0;}</style><div class="MuiBox-root css-5w8nlu"></div><style data-emotion="css 12o98wt">.css-12o98wt{position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;min-height:56px;}@media (min-width:0px){@media (orientation: landscape){.css-12o98wt{min-height:48px;}}}@media (min-width:600px){.css-12o98wt{min-height:64px;}}</style><div class="MuiToolbar-root MuiToolbar-regular css-12o98wt"><style data-emotion="css k1l6qz">.css-k1l6qz{gap:8px;margin:0 24px 0 auto;}@media (min-width:0px){.css-k1l6qz{display:none;}}@media (min-width:900px){.css-k1l6qz{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}</style><div class="MuiBox-root css-k1l6qz"><a href="/2023/"><style data-emotion="css lkk890">.css-lkk890{margin:0;font-size:24px;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;line-height:1.5;letter-spacing:0.00938em;color:#2E353B;font-family:'__Poppins_bfe252','__Poppins_Fallback_bfe252',Helvetica Neue,Arial,Hiragino Kaku Gothic ProN,Hiragino Sans,Meiryo,sans-serif;padding:4px 8px;}@media (max-width:599.95px){.css-lkk890{font-size:16px;}}.css-lkk890:hover{cursor:pointer;color:#82919D;}.css-lkk890:active{color:#82919D;background-color:rgba(46, 53, 59, 0.1);}</style><p class="MuiTypography-root MuiTypography-body1 css-lkk890">Home</p></a><a href="/2023/sessions/"><p class="MuiTypography-root MuiTypography-body1 css-lkk890">Sessions</p></a><a href="/2023/timetable/"><p class="MuiTypography-root MuiTypography-body1 css-lkk890">Timetable</p></a><a href="/2023/floor_guide/"><p class="MuiTypography-root MuiTypography-body1 css-lkk890">Floor Guide</p></a><a href="/2023/staff/"><p class="MuiTypography-root MuiTypography-body1 css-lkk890">Staff</p></a><style data-emotion="css 1l6gsna">.css-1l6gsna{margin:0;font-size:24px;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;line-height:1.5;letter-spacing:0.00938em;color:#2E353B;font-family:'__Poppins_bfe252','__Poppins_Fallback_bfe252',Helvetica Neue,Arial,Hiragino Kaku Gothic ProN,Hiragino Sans,Meiryo,sans-serif;padding:4px 8px;}@media (max-width:599.95px){.css-1l6gsna{font-size:16px;}}.css-1l6gsna:hover{cursor:pointer;color:#82919D;}.css-1l6gsna:active{color:#82919D;background-color:rgba(46, 53, 59, 0.1);}</style><p class="MuiTypography-root MuiTypography-body1 css-1l6gsna">English</p></div><style data-emotion="css 1730rsd">.css-1730rsd{-webkit-box-pack:end;-ms-flex-pack:end;-webkit-justify-content:flex-end;justify-content:flex-end;-webkit-flex:1;-ms-flex:1;flex:1;}@media (min-width:0px){.css-1730rsd{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}@media (min-width:900px){.css-1730rsd{display:none;}}</style><div class="MuiBox-root css-1730rsd"><style data-emotion="css 1wf493t">.css-1wf493t{text-align:center;-webkit-flex:0 0 auto;-ms-flex:0 0 auto;flex:0 0 auto;font-size:1.5rem;padding:8px;border-radius:50%;overflow:visible;color:rgba(0, 0, 0, 0.54);-webkit-transition:background-color 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:background-color 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;}.css-1wf493t:hover{background-color:rgba(0, 0, 0, 0.04);}@media (hover: none){.css-1wf493t:hover{background-color:transparent;}}.css-1wf493t.Mui-disabled{background-color:transparent;color:rgba(0, 0, 0, 0.26);}</style><style data-emotion="css 1yxmbwk">.css-1yxmbwk{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;position:relative;box-sizing:border-box;-webkit-tap-highlight-color:transparent;background-color:transparent;outline:0;border:0;margin:0;border-radius:0;padding:0;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;vertical-align:middle;-moz-appearance:none;-webkit-appearance:none;-webkit-text-decoration:none;text-decoration:none;color:inherit;text-align:center;-webkit-flex:0 0 auto;-ms-flex:0 0 auto;flex:0 0 auto;font-size:1.5rem;padding:8px;border-radius:50%;overflow:visible;color:rgba(0, 0, 0, 0.54);-webkit-transition:background-color 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:background-color 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;}.css-1yxmbwk::-moz-focus-inner{border-style:none;}.css-1yxmbwk.Mui-disabled{pointer-events:none;cursor:default;}@media print{.css-1yxmbwk{-webkit-print-color-adjust:exact;color-adjust:exact;}}.css-1yxmbwk:hover{background-color:rgba(0, 0, 0, 0.04);}@media (hover: none){.css-1yxmbwk:hover{background-color:transparent;}}.css-1yxmbwk.Mui-disabled{background-color:transparent;color:rgba(0, 0, 0, 0.26);}</style><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeMedium css-1yxmbwk" tabindex="0" type="button"><style data-emotion="css 1ds1xfi">.css-1ds1xfi{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:1em;height:1em;display:inline-block;fill:currentColor;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;-webkit-transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;font-size:1.5rem;font-size:24px;color:#2E353B;}</style><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium css-1ds1xfi" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="MenuRoundedIcon"><path d="M4 18h16c.55 0 1-.45 1-1s-.45-1-1-1H4c-.55 0-1 .45-1 1s.45 1 1 1zm0-5h16c.55 0 1-.45 1-1s-.45-1-1-1H4c-.55 0-1 .45-1 1s.45 1 1 1zM3 7c0 .55.45 1 1 1h16c.55 0 1-.45 1-1s-.45-1-1-1H4c-.55 0-1 .45-1 1z"></path></svg></button></div></div></header><main class="MuiBox-root css-0"><style data-emotion="css 23u5y1">.css-23u5y1{max-width:1024px;margin-left:auto;margin-right:auto;background-color:#FFFFFF;border-radius:20px;}@media (min-width:0px){.css-23u5y1{padding-left:16px;padding-right:16px;}}@media (min-width:600px){.css-23u5y1{padding-left:32px;padding-right:32px;}}</style><div class="MuiBox-root css-23u5y1"><style data-emotion="css hz07qv">.css-hz07qv{margin:0;font-size:50px;font-weight:500;font-family:"Roboto","Helvetica","Arial",sans-serif;line-height:1.167;letter-spacing:-0.01562em;color:#2E353B;font-family:'__Poppins_bfe252','__Poppins_Fallback_bfe252',Helvetica Neue,Arial,Hiragino Kaku Gothic ProN,Hiragino Sans,Meiryo,sans-serif;text-align:left;}@media (max-width:599.95px){.css-hz07qv{font-size:24px;}}@media (min-width:0px){.css-hz07qv{margin-top:80px;margin-bottom:32px;}}@media (min-width:600px){.css-hz07qv{margin-top:160px;margin-bottom:72px;}}</style><h1 class="MuiTypography-root MuiTypography-h1 css-hz07qv">Go1.20からサポートされるtree構造のerrの紹介と、treeを考慮した複数マッチができるライブラリを作った話</h1><style data-emotion="css 1xlgar0">.css-1xlgar0{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;gap:16px;margin-bottom:32px;}</style><div class="MuiBox-root css-1xlgar0"><style data-emotion="css 1c1kq07">.css-1c1kq07{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;gap:8px;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><div class="MuiBox-root css-1c1kq07"><style data-emotion="css 7rwzu3">.css-7rwzu3{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;background-color:#EF5DA8;border-radius:2px;padding:2px 4px;width:-webkit-fit-content;width:-moz-fit-content;width:fit-content;}</style><div class="MuiBox-root css-7rwzu3"><style data-emotion="css 1c0pdim">.css-1c0pdim{margin:0;font-size:12px;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;line-height:1.66;letter-spacing:0.03333em;color:#FFFFFF;font-family:'__Poppins_bfe252','__Poppins_Fallback_bfe252',Helvetica Neue,Arial,Hiragino Kaku Gothic ProN,Hiragino Sans,Meiryo,sans-serif;}@media (max-width:599.95px){.css-1c0pdim{font-size:10px;}}</style><span class="MuiTypography-root MuiTypography-caption css-1c0pdim">Room A : A10-S</span></div></div><style data-emotion="css 1iwn1vi">.css-1iwn1vi{margin:0;font-size:18px;line-height:150%;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;letter-spacing:0.01071em;color:#2E353B;font-family:'__Poppins_bfe252','__Poppins_Fallback_bfe252',Helvetica Neue,Arial,Hiragino Kaku Gothic ProN,Hiragino Sans,Meiryo,sans-serif;white-space:pre-wrap;}@media (max-width:599.95px){.css-1iwn1vi{font-size:14px;}}</style><p class="MuiTypography-root MuiTypography-body2 css-1iwn1vi">Go1.20からはtree構造のエラーがサポートされることになりました。
詳細は以下のrelease noteでも言及されています。
<style data-emotion="css 1jwg62n">.css-1jwg62n{-webkit-text-decoration:underline;text-decoration:underline;text-decoration-color:rgba(25, 118, 210, 0.4);color:#0078F9;text-decoration-color:#0078F9;word-break:break-word;}.css-1jwg62n:hover{text-decoration-color:inherit;}.css-1jwg62n:hover{color:#6199DA;text-decoration-color:#6199DA;}</style><style data-emotion="css 1xfmx9o">.css-1xfmx9o{margin:0;color:#1976d2;font-family:'__Poppins_bfe252','__Poppins_Fallback_bfe252',Helvetica Neue,Arial,Hiragino Kaku Gothic ProN,Hiragino Sans,Meiryo,sans-serif;-webkit-text-decoration:underline;text-decoration:underline;text-decoration-color:rgba(25, 118, 210, 0.4);color:#0078F9;text-decoration-color:#0078F9;word-break:break-word;}.css-1xfmx9o:hover{text-decoration-color:inherit;}.css-1xfmx9o:hover{color:#6199DA;text-decoration-color:#6199DA;}</style><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineAlways css-1xfmx9o" href="https://tip.golang.org/doc/go1.20#errors" target="_blank">https://tip.golang.org/doc/go1.20#errors</a>

もともとのproposalである <a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineAlways css-1xfmx9o" href="https://github.com/golang/go/issues/53435" target="_blank">https://github.com/golang/go/issues/53435</a> での議論をふまえ、Go1.20時点では、標準errors.Is/Asは以下のデザインとなっています。

- treeを深さ優先探索する
- マッチしたものがあればそこで探索を打ち切り結果を返す
- tree上のすべての枝がIs/Asにマッチすることを保証しない

ですが、tree構造とのマッチ判定はユースケースによってはさらにいくつかの要求が考えられます。たとえば

- 分岐した全枝についての一致を確認するより厳密な同一性判定
- treeのなかで一致した要素をすべて取り出す

などです。このようなより柔軟な要求に対して、現状の標準errors.Is/Asを利用することはできません。

今回は元となった &quot;errors: add support for wrapping multiple errors&quot; proposalでの議論をおさらいしつつ、標準errorsでは実現できないいくつかの要求についてマッチ処理を実装したので紹介します。
また、実装中に感じた課題などについても触れれればと思います。

実装したレポジトリは以下です。
<a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineAlways css-1xfmx9o" href="https://github.com/convto/errortree" target="_blank">https://github.com/convto/errortree</a>

tree構造のerrはGo1.20から追加された新しい概念であり、整理のために多くの実験や議論が必要だと思っています。
この発表で該当の議論に関心を持つ方が増えれば嬉しいです。</p><style data-emotion="css g5zuwl">.css-g5zuwl{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;gap:8px;-webkit-align-items:flex-end;-webkit-box-align:flex-end;-ms-flex-align:flex-end;align-items:flex-end;}</style><div class="MuiBox-root css-g5zuwl"><style data-emotion="css 605szw">.css-605szw{margin:0;font-size:12px;line-height:120%;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;letter-spacing:0.00938em;color:#728393;font-family:'__Poppins_bfe252','__Poppins_Fallback_bfe252',Helvetica Neue,Arial,Hiragino Kaku Gothic ProN,Hiragino Sans,Meiryo,sans-serif;}@media (max-width:599.95px){.css-605szw{font-size:11px;}}</style><h6 class="MuiTypography-root MuiTypography-subtitle1 css-605szw">Short Talk(20min)</h6></div></div><style data-emotion="css owsqbn">.css-owsqbn{background-color:#F7F9FB;border-radius:12px;margin-bottom:16px;}@media (min-width:0px){.css-owsqbn{padding:16px;}}@media (min-width:600px){.css-owsqbn{padding:32px;}}</style><div class="MuiBox-root css-owsqbn"><style data-emotion="css qrrc4a">.css-qrrc4a{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;gap:8px;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin-bottom:8px;}</style><div class="MuiBox-root css-qrrc4a"><style data-emotion="css sv0sk2">.css-sv0sk2{position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;width:40px;height:40px;font-family:"Roboto","Helvetica","Arial",sans-serif;font-size:1.25rem;line-height:1;border-radius:50%;overflow:hidden;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:60px;height:60px;border:1px solid rgba(0, 0, 0, 0.08);}</style><div class="MuiAvatar-root MuiAvatar-circular css-sv0sk2"><style data-emotion="css 1hy9t21">.css-1hy9t21{width:100%;height:100%;text-align:center;object-fit:cover;color:transparent;text-indent:10000px;}</style><img alt="奥村 優哉" src="https://sessionize.com/image/09e1-400o400o2-4267faff-b45c-4867-868f-3dcca0492d3e.jpg" class="MuiAvatar-img css-1hy9t21"/></div><style data-emotion="css 1821gv5">.css-1821gv5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;gap:8px;}</style><div class="MuiBox-root css-1821gv5"><style data-emotion="css 1dhr4ct">.css-1dhr4ct{margin:0;font-size:20px;font-weight:700;font-family:"Roboto","Helvetica","Arial",sans-serif;line-height:1.235;letter-spacing:0.00735em;color:#2E353B;font-family:'__Poppins_bfe252','__Poppins_Fallback_bfe252',Helvetica Neue,Arial,Hiragino Kaku Gothic ProN,Hiragino Sans,Meiryo,sans-serif;}@media (max-width:599.95px){.css-1dhr4ct{font-size:16px;}}</style><h4 class="MuiTypography-root MuiTypography-h4 css-1dhr4ct">奥村 優哉</h4><h6 class="MuiTypography-root MuiTypography-subtitle1 css-605szw">株式会社LayerX</h6></div><style data-emotion="css 1mf7gxt">.css-1mf7gxt{-webkit-text-decoration:underline;text-decoration:underline;text-decoration-color:rgba(25, 118, 210, 0.4);color:#2E353B;margin-left:auto;-webkit-align-self:flex-start;-ms-flex-item-align:flex-start;align-self:flex-start;}.css-1mf7gxt:hover{text-decoration-color:inherit;}.css-1mf7gxt:hover{color:#728393;}</style><style data-emotion="css 1q1tr9h">.css-1q1tr9h{margin:0;color:#1976d2;font-family:'__Poppins_bfe252','__Poppins_Fallback_bfe252',Helvetica Neue,Arial,Hiragino Kaku Gothic ProN,Hiragino Sans,Meiryo,sans-serif;-webkit-text-decoration:underline;text-decoration:underline;text-decoration-color:rgba(25, 118, 210, 0.4);color:#2E353B;margin-left:auto;-webkit-align-self:flex-start;-ms-flex-item-align:flex-start;align-self:flex-start;}.css-1q1tr9h:hover{text-decoration-color:inherit;}.css-1q1tr9h:hover{color:#728393;}</style><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineAlways css-1q1tr9h" href="https://twitter.com/convto" target="_blank"><style data-emotion="css vubbuv">.css-vubbuv{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:1em;height:1em;display:inline-block;fill:currentColor;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;-webkit-transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;font-size:1.5rem;}</style><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium css-vubbuv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="TwitterIcon"><path d="M22.46 6c-.77.35-1.6.58-2.46.69.88-.53 1.56-1.37 1.88-2.38-.83.5-1.75.85-2.72 1.05C18.37 4.5 17.26 4 16 4c-2.35 0-4.27 1.92-4.27 4.29 0 .34.04.67.11.98C8.28 9.09 5.11 7.38 3 4.79c-.37.63-.58 1.37-.58 2.15 0 1.49.75 2.81 1.91 3.56-.71 0-1.37-.2-1.95-.5v.03c0 2.08 1.48 3.82 3.44 4.21a4.22 4.22 0 0 1-1.93.07 4.28 4.28 0 0 0 4 2.98 8.521 8.521 0 0 1-5.33 1.84c-.34 0-.68-.02-1.02-.06C3.44 20.29 5.7 21 8.12 21 16 21 20.33 14.46 20.33 8.79c0-.19 0-.37-.01-.56.84-.6 1.56-1.36 2.14-2.23z"></path></svg></a></div><p class="MuiTypography-root MuiTypography-body2 css-1iwn1vi">レイヤ低めの技術、暗号まわり、分散コンピューティングに興味があります</p></div><style data-emotion="css svw3pz">.css-svw3pz{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:end;-ms-flex-pack:end;-webkit-justify-content:flex-end;justify-content:flex-end;margin-bottom:64px;}</style><div class="MuiBox-root css-svw3pz"><style data-emotion="css 11h4ml6">.css-11h4ml6{-webkit-text-decoration:underline;text-decoration:underline;text-decoration-color:rgba(25, 118, 210, 0.4);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;gap:4px;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-text-decoration:none;text-decoration:none;color:#2E353B;}.css-11h4ml6:hover{text-decoration-color:inherit;}.css-11h4ml6:hover{color:#82919D;-webkit-text-decoration:underline;text-decoration:underline;}</style><style data-emotion="css 1od6ge4">.css-1od6ge4{margin:0;font-size:18px;line-height:150%;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;letter-spacing:0.01071em;color:#1976d2;font-family:'__Poppins_bfe252','__Poppins_Fallback_bfe252',Helvetica Neue,Arial,Hiragino Kaku Gothic ProN,Hiragino Sans,Meiryo,sans-serif;-webkit-text-decoration:underline;text-decoration:underline;text-decoration-color:rgba(25, 118, 210, 0.4);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;gap:4px;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-text-decoration:none;text-decoration:none;color:#2E353B;}@media (max-width:599.95px){.css-1od6ge4{font-size:14px;}}.css-1od6ge4:hover{text-decoration-color:inherit;}.css-1od6ge4:hover{color:#82919D;-webkit-text-decoration:underline;text-decoration:underline;}</style><a class="MuiTypography-root MuiTypography-body2 MuiLink-root MuiLink-underlineAlways css-1od6ge4" href="https://twitter.com/intent/tweet?url=https://gocon.jp/2023/sessions/A10-S&amp;text=Go1.20からサポートされるtree構造のerrの紹介と、treeを考慮した複数マッチができるライブラリを作った話&amp;hashtags=gocon,goconA" target="_blank"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium css-vubbuv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="TwitterIcon" aria-label="ツイート"><path d="M22.46 6c-.77.35-1.6.58-2.46.69.88-.53 1.56-1.37 1.88-2.38-.83.5-1.75.85-2.72 1.05C18.37 4.5 17.26 4 16 4c-2.35 0-4.27 1.92-4.27 4.29 0 .34.04.67.11.98C8.28 9.09 5.11 7.38 3 4.79c-.37.63-.58 1.37-.58 2.15 0 1.49.75 2.81 1.91 3.56-.71 0-1.37-.2-1.95-.5v.03c0 2.08 1.48 3.82 3.44 4.21a4.22 4.22 0 0 1-1.93.07 4.28 4.28 0 0 0 4 2.98 8.521 8.521 0 0 1-5.33 1.84c-.34 0-.68-.02-1.02-.06C3.44 20.29 5.7 21 8.12 21 16 21 20.33 14.46 20.33 8.79c0-.19 0-.37-.01-.56.84-.6 1.56-1.36 2.14-2.23z"></path></svg><span>ツイート</span></a></div><style data-emotion="css 1lekzkb">.css-1lekzkb{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;}</style><div class="MuiBox-root css-1lekzkb"><a href="/2023/sessions/"><style data-emotion="css sximv7">.css-sximv7{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:#728393;}.css-sximv7:hover{color:#2E353B;-webkit-text-decoration:underline;text-decoration:underline;}</style><div class="MuiBox-root css-sximv7"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium css-vubbuv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ArrowBackIosNewIcon"><path d="M17.77 3.77 16 2 6 12l10 10 1.77-1.77L9.54 12z"></path></svg><style data-emotion="css 1m2jks5">.css-1m2jks5{margin:0;font-size:18px;line-height:150%;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;letter-spacing:0.01071em;color:#728393;font-family:'__Poppins_bfe252','__Poppins_Fallback_bfe252',Helvetica Neue,Arial,Hiragino Kaku Gothic ProN,Hiragino Sans,Meiryo,sans-serif;}@media (max-width:599.95px){.css-1m2jks5{font-size:14px;}}.css-1m2jks5:hover{color:#A3AEB9;}</style><p class="MuiTypography-root MuiTypography-body2 css-1m2jks5">All Sessions</p></div></a><a href="/2023/timetable/"><div class="MuiBox-root css-sximv7"><p class="MuiTypography-root MuiTypography-body2 css-1m2jks5">Timetable</p><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium css-vubbuv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ArrowForwardIosIcon"><path d="M6.23 20.23 8 22l10-10L8 2 6.23 3.77 14.46 12z"></path></svg></div></a></div></div></main><style data-emotion="css 1hjb12a">.css-1hjb12a{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:flex-end;-webkit-box-align:flex-end;-ms-flex-align:flex-end;align-items:flex-end;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;gap:4px;width:100%;padding:64px 16px 16px;margin-top:auto;}</style><div class="MuiBox-root css-1hjb12a"><img alt="gopher conductor" loading="lazy" width="84" height="92" decoding="async" data-nimg="1" style="color:transparent;min-width:0;object-fit:contain" src="/2023/_next/static/media/gopher-conductor.ba52d982.png"/><img alt="gopher drummer" loading="lazy" width="82" height="88" decoding="async" data-nimg="1" style="color:transparent;min-width:0;object-fit:contain" src="/2023/_next/static/media/gopher-drummer.3c6e8ddd.png"/><img alt="gopher trumpeter" loading="lazy" width="84" height="78" decoding="async" data-nimg="1" style="color:transparent;min-width:0;object-fit:contain" src="/2023/_next/static/media/gopher-trumpeter.bfa847ad.png"/><img alt="gopher pom pom" loading="lazy" width="60" height="56" decoding="async" data-nimg="1" style="color:transparent;min-width:0;object-fit:contain" src="/2023/_next/static/media/gopher-pom-pom.da0a023d.png"/><img alt="gopher flower blue" loading="lazy" width="85" height="78" decoding="async" data-nimg="1" style="color:transparent;min-width:0;object-fit:contain" src="/2023/_next/static/media/gopher-flower-blue.f910d37c.png"/></div><style data-emotion="css 1l9291m">.css-1l9291m{background-color:#F5F5F5;}</style><footer class="MuiBox-root css-1l9291m"><style data-emotion="css ycbz48">.css-ycbz48{max-width:1024px;margin-left:auto;margin-right:auto;padding-top:32px;padding-bottom:32px;border-bottom:solid 1px #E5E5E5;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;gap:24px;}@media (min-width:0px){.css-ycbz48{padding-left:16px;padding-right:16px;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}}@media (min-width:600px){.css-ycbz48{padding-left:36px;padding-right:36px;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;}}</style><div class="MuiBox-root css-ycbz48"><style data-emotion="css i9gxme">.css-i9gxme{-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;}</style><div class="MuiBox-root css-i9gxme"><style data-emotion="css deg97p">.css-deg97p{margin:0;font-size:20px;font-weight:700;font-family:"Roboto","Helvetica","Arial",sans-serif;line-height:1.235;letter-spacing:0.00735em;color:#2E353B;font-family:'__Poppins_bfe252','__Poppins_Fallback_bfe252',Helvetica Neue,Arial,Hiragino Kaku Gothic ProN,Hiragino Sans,Meiryo,sans-serif;margin-bottom:8px;}@media (max-width:599.95px){.css-deg97p{font-size:16px;}}</style><h4 class="MuiTypography-root MuiTypography-h4 css-deg97p">About</h4><style data-emotion="css 1ontqvh">.css-1ontqvh{list-style:none;margin:0;padding:0;position:relative;padding-top:8px;padding-bottom:8px;}</style><ul class="MuiList-root MuiList-padding css-1ontqvh"><style data-emotion="css 3zcl9c">.css-3zcl9c{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:start;-ms-flex-pack:start;-webkit-justify-content:flex-start;justify-content:flex-start;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;position:relative;-webkit-text-decoration:none;text-decoration:none;width:100%;box-sizing:border-box;text-align:left;padding-top:8px;padding-bottom:8px;padding-left:16px;padding-right:16px;padding-left:0;padding-right:0;}.css-3zcl9c.Mui-focusVisible{background-color:rgba(0, 0, 0, 0.12);}.css-3zcl9c.Mui-selected{background-color:rgba(25, 118, 210, 0.08);}.css-3zcl9c.Mui-selected.Mui-focusVisible{background-color:rgba(25, 118, 210, 0.2);}.css-3zcl9c.Mui-disabled{opacity:0.38;}</style><li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding css-3zcl9c"><style data-emotion="css mhe2py">.css-mhe2py{-webkit-text-decoration:underline;text-decoration:underline;text-decoration-color:rgba(25, 118, 210, 0.4);color:#2E353B;text-decoration-color:#2E353B;word-break:break-word;}.css-mhe2py:hover{text-decoration-color:inherit;}.css-mhe2py:hover{color:#82919D;text-decoration-color:#82919D;}</style><style data-emotion="css 1pkmwlf">.css-1pkmwlf{margin:0;color:#1976d2;font-family:'__Poppins_bfe252','__Poppins_Fallback_bfe252',Helvetica Neue,Arial,Hiragino Kaku Gothic ProN,Hiragino Sans,Meiryo,sans-serif;-webkit-text-decoration:underline;text-decoration:underline;text-decoration-color:rgba(25, 118, 210, 0.4);color:#2E353B;text-decoration-color:#2E353B;word-break:break-word;}.css-1pkmwlf:hover{text-decoration-color:inherit;}.css-1pkmwlf:hover{color:#82919D;text-decoration-color:#82919D;}</style><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineAlways css-1pkmwlf" href="https://go.dev/conduct" target="_blank">Code of Conduct</a></li><li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding css-3zcl9c"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineAlways css-1pkmwlf" href="mailto:info@gocon.jp" target="_blank">INFO@GOCON.JP</a></li><li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding css-3zcl9c"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineAlways css-1pkmwlf" href="https://drive.google.com/file/d/1Xon1uyLT-810sxnkLMngmL67z68K3XJG/view" target="_blank">特定商取引法に基づく表記</a></li></ul></div><div class="MuiBox-root css-i9gxme"><h4 class="MuiTypography-root MuiTypography-h4 css-deg97p">Past Conferences</h4><ul class="MuiList-root MuiList-padding css-1ontqvh"><li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding css-3zcl9c"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineAlways css-1pkmwlf" href="https://gocon.jp/2022spring" target="_blank">2022 Spring</a></li><li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding css-3zcl9c"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineAlways css-1pkmwlf" href="https://gocon.jp/2021autumn" target="_blank">2021 Autumn</a></li><li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding css-3zcl9c"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineAlways css-1pkmwlf" href="https://gocon.jp/2021spring" target="_blank">2021 Spring</a></li></ul></div></div><style data-emotion="css td7y8x">.css-td7y8x{max-width:1024px;margin-left:auto;margin-right:auto;padding-top:24px;padding-bottom:24px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;gap:16px;}@media (min-width:0px){.css-td7y8x{padding-left:16px;padding-right:16px;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}@media (min-width:600px){.css-td7y8x{padding-left:36px;padding-right:36px;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}}</style><div class="MuiBox-root css-td7y8x"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineAlways css-1pkmwlf" href="https://twitter.com/hashtag/gocon" target="_blank"><style data-emotion="css 1i27l4i">.css-1i27l4i{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;gap:8px;}</style><div class="MuiBox-root css-1i27l4i"><style data-emotion="css vubbuv">.css-vubbuv{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:1em;height:1em;display:inline-block;fill:currentColor;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;-webkit-transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;font-size:1.5rem;}</style><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium css-vubbuv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="TwitterIcon"><path d="M22.46 6c-.77.35-1.6.58-2.46.69.88-.53 1.56-1.37 1.88-2.38-.83.5-1.75.85-2.72 1.05C18.37 4.5 17.26 4 16 4c-2.35 0-4.27 1.92-4.27 4.29 0 .34.04.67.11.98C8.28 9.09 5.11 7.38 3 4.79c-.37.63-.58 1.37-.58 2.15 0 1.49.75 2.81 1.91 3.56-.71 0-1.37-.2-1.95-.5v.03c0 2.08 1.48 3.82 3.44 4.21a4.22 4.22 0 0 1-1.93.07 4.28 4.28 0 0 0 4 2.98 8.521 8.521 0 0 1-5.33 1.84c-.34 0-.68-.02-1.02-.06C3.44 20.29 5.7 21 8.12 21 16 21 20.33 14.46 20.33 8.79c0-.19 0-.37-.01-.56.84-.6 1.56-1.36 2.14-2.23z"></path></svg><span>#GOCON</span></div></a><style data-emotion="css 1kkt86i">.css-1kkt86i{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;gap:4px;}</style><div class="MuiBox-root css-1kkt86i"><style data-emotion="css 13968zk">.css-13968zk{margin:0;font-size:18px;line-height:150%;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;letter-spacing:0.01071em;color:#728393;font-family:'__Poppins_bfe252','__Poppins_Fallback_bfe252',Helvetica Neue,Arial,Hiragino Kaku Gothic ProN,Hiragino Sans,Meiryo,sans-serif;}@media (max-width:599.95px){.css-13968zk{font-size:14px;}}@media (min-width:0px){.css-13968zk{text-align:left;}}@media (min-width:600px){.css-13968zk{text-align:right;}}</style><p class="MuiTypography-root MuiTypography-body2 css-13968zk">Go Conference</p><style data-emotion="css ni76eq">.css-ni76eq{margin:0;font-size:12px;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;line-height:1.66;letter-spacing:0.03333em;color:#728393;font-family:'__Poppins_bfe252','__Poppins_Fallback_bfe252',Helvetica Neue,Arial,Hiragino Kaku Gothic ProN,Hiragino Sans,Meiryo,sans-serif;}@media (max-width:599.95px){.css-ni76eq{font-size:10px;}}@media (min-width:0px){.css-ni76eq{text-align:left;}}@media (min-width:600px){.css-ni76eq{text-align:right;}}</style><span class="MuiTypography-root MuiTypography-caption css-ni76eq">The Go gopher was designed by<!-- --> <style data-emotion="css 15id52">.css-15id52{-webkit-text-decoration:underline;text-decoration:underline;text-decoration-color:rgba(25, 118, 210, 0.4);color:#728393;text-decoration-color:#728393;word-break:break-word;}.css-15id52:hover{text-decoration-color:inherit;}.css-15id52:hover{color:#A3AEB9;text-decoration-color:#A3AEB9;}</style><style data-emotion="css 15pd7c2">.css-15pd7c2{margin:0;color:#1976d2;font-family:'__Poppins_bfe252','__Poppins_Fallback_bfe252',Helvetica Neue,Arial,Hiragino Kaku Gothic ProN,Hiragino Sans,Meiryo,sans-serif;-webkit-text-decoration:underline;text-decoration:underline;text-decoration-color:rgba(25, 118, 210, 0.4);color:#728393;text-decoration-color:#728393;word-break:break-word;}.css-15pd7c2:hover{text-decoration-color:inherit;}.css-15pd7c2:hover{color:#A3AEB9;text-decoration-color:#A3AEB9;}</style><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineAlways css-15pd7c2" href="http://reneefrench.blogspot.com/" target="_blank">Renée French</a>. Illustrations by<!-- --> <a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineAlways css-15pd7c2" href="https://twitter.com/tottie_designer" target="_blank">tottie</a>.</span></div></div></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"title":"Go1.20からサポートされるtree構造のerrの紹介と、treeを考慮した複数マッチができるライブラリを作った話","roomName":"Room A","sessionId":"A10-S","description":"Go1.20からはtree構造のエラーがサポートされることになりました。\r\n詳細は以下のrelease noteでも言及されています。\r\nhttps://tip.golang.org/doc/go1.20#errors\r\n\r\nもともとのproposalである https://github.com/golang/go/issues/53435 での議論をふまえ、Go1.20時点では、標準errors.Is/Asは以下のデザインとなっています。\r\n\r\n- treeを深さ優先探索する\r\n- マッチしたものがあればそこで探索を打ち切り結果を返す\r\n- tree上のすべての枝がIs/Asにマッチすることを保証しない\r\n\r\nですが、tree構造とのマッチ判定はユースケースによってはさらにいくつかの要求が考えられます。たとえば\r\n\r\n- 分岐した全枝についての一致を確認するより厳密な同一性判定\r\n- treeのなかで一致した要素をすべて取り出す\r\n\r\nなどです。このようなより柔軟な要求に対して、現状の標準errors.Is/Asを利用することはできません。\r\n\r\n今回は元となった \"errors: add support for wrapping multiple errors\" proposalでの議論をおさらいしつつ、標準errorsでは実現できないいくつかの要求についてマッチ処理を実装したので紹介します。\r\nまた、実装中に感じた課題などについても触れれればと思います。\r\n\r\n実装したレポジトリは以下です。\r\nhttps://github.com/convto/errortree\r\n\r\ntree構造のerrはGo1.20から追加された新しい概念であり、整理のために多くの実験や議論が必要だと思っています。\r\nこの発表で該当の議論に関心を持つ方が増えれば嬉しいです。","sessionLevel":null,"sessionType":"Short Talk(20min)","recordingUrl":null,"slideUrl":null,"speaker":{"fullName":"奥村 優哉","profilePicture":"https://sessionize.com/image/09e1-400o400o2-4267faff-b45c-4867-868f-3dcca0492d3e.jpg","bio":"レイヤ低めの技術、暗号まわり、分散コンピューティングに興味があります","tagLine":"株式会社LayerX","twitterUserName":"convto"}},"__N_SSG":true},"page":"/sessions/[id]","query":{"id":"A10-S"},"buildId":"Pa456hInAa-dSv_O0Jk7e","assetPrefix":"/2023","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>