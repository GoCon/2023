<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>Go Conference 2023</title><base href="/2023/"/><link rel="icon" href="/2023/favicon.ico"/><meta name="description" content="Go Conference is a conference for Go programming language users."/><meta property="og:site_name" content="Go Conference 2023"/><meta property="og:title" content="Go Conference 2023"/><meta property="og:description" content="Go Conference is a conference for Go programming language users."/><meta property="og:type" content="website"/><meta property="og:url" content="https://gocon.jp/2023"/><meta property="og:image" content="https://gocon.jp/2023/ogp-thumbnail.png"/><meta name="twitter:card" content="summary_large_image"/><meta name="next-head-count" content="13"/><link rel="preload" href="/2023/_next/static/media/916d3686010a8de2-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/2023/_next/static/media/7777133e901cd5ed-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/2023/_next/static/media/d869208648ca5469-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/2023/_next/static/media/9a881e2ac07d406b-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/2023/_next/static/css/cbd62f3d07239dc3.css" as="style"/><link rel="stylesheet" href="/2023/_next/static/css/cbd62f3d07239dc3.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/2023/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/2023/_next/static/chunks/webpack-a7b0d116b21ecd51.js" defer=""></script><script src="/2023/_next/static/chunks/framework-2c79e2a64abdb08b.js" defer=""></script><script src="/2023/_next/static/chunks/main-3f0e60bff2004706.js" defer=""></script><script src="/2023/_next/static/chunks/pages/_app-d4a5c17195d1c213.js" defer=""></script><script src="/2023/_next/static/chunks/fec483df-84b60e9b787738d5.js" defer=""></script><script src="/2023/_next/static/chunks/603-344c72eb69da11aa.js" defer=""></script><script src="/2023/_next/static/chunks/504-5cb38a10a2545bb4.js" defer=""></script><script src="/2023/_next/static/chunks/pages/sessions/%5Bid%5D-bfd0579f8e6f7ffc.js" defer=""></script><script src="/2023/_next/static/a1OLcSOxYttiSaOLVVhcn/_buildManifest.js" defer=""></script><script src="/2023/_next/static/a1OLcSOxYttiSaOLVVhcn/_ssgManifest.js" defer=""></script></head><body><div id="__next"><style data-emotion="css mdfyde">.css-mdfyde{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;width:100%;box-sizing:border-box;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;position:fixed;z-index:1100;top:0;left:auto;right:0;background-color:#1976d2;color:#fff;background-color:#fff0;height:100px;box-shadow:none;}@media print{.css-mdfyde{position:absolute;}}</style><style data-emotion="css 13r0ouy">.css-13r0ouy{background-color:#fff;color:rgba(0, 0, 0, 0.87);-webkit-transition:box-shadow 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:box-shadow 300ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;box-shadow:0px 2px 4px -1px rgba(0,0,0,0.2),0px 4px 5px 0px rgba(0,0,0,0.14),0px 1px 10px 0px rgba(0,0,0,0.12);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;width:100%;box-sizing:border-box;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;position:fixed;z-index:1100;top:0;left:auto;right:0;background-color:#1976d2;color:#fff;background-color:#fff0;height:100px;box-shadow:none;}@media print{.css-13r0ouy{position:absolute;}}</style><header class="MuiPaper-root MuiPaper-elevation MuiPaper-elevation4 MuiAppBar-root MuiAppBar-colorPrimary MuiAppBar-positionFixed mui-fixed css-13r0ouy"><style data-emotion="css 5w8nlu">.css-5w8nlu{-webkit-transition:200ms all linear;transition:200ms all linear;position:absolute;width:100%;height:128px;background:linear-gradient(180deg, #4E96E9 19.27%, rgba(77, 148, 230, 0) 88.54%);opacity:0;}</style><div class="MuiBox-root css-5w8nlu"></div><style data-emotion="css 12o98wt">.css-12o98wt{position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;min-height:56px;}@media (min-width:0px){@media (orientation: landscape){.css-12o98wt{min-height:48px;}}}@media (min-width:600px){.css-12o98wt{min-height:64px;}}</style><div class="MuiToolbar-root MuiToolbar-regular css-12o98wt"><style data-emotion="css 1j9bsaa">.css-1j9bsaa{-webkit-flex:1;-ms-flex:1;flex:1;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:end;-ms-flex-pack:end;-webkit-justify-content:flex-end;justify-content:flex-end;}</style><div class="MuiBox-root css-1j9bsaa"><style data-emotion="css 1wf493t">.css-1wf493t{text-align:center;-webkit-flex:0 0 auto;-ms-flex:0 0 auto;flex:0 0 auto;font-size:1.5rem;padding:8px;border-radius:50%;overflow:visible;color:rgba(0, 0, 0, 0.54);-webkit-transition:background-color 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:background-color 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;}.css-1wf493t:hover{background-color:rgba(0, 0, 0, 0.04);}@media (hover: none){.css-1wf493t:hover{background-color:transparent;}}.css-1wf493t.Mui-disabled{background-color:transparent;color:rgba(0, 0, 0, 0.26);}</style><style data-emotion="css 1yxmbwk">.css-1yxmbwk{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;position:relative;box-sizing:border-box;-webkit-tap-highlight-color:transparent;background-color:transparent;outline:0;border:0;margin:0;border-radius:0;padding:0;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;vertical-align:middle;-moz-appearance:none;-webkit-appearance:none;-webkit-text-decoration:none;text-decoration:none;color:inherit;text-align:center;-webkit-flex:0 0 auto;-ms-flex:0 0 auto;flex:0 0 auto;font-size:1.5rem;padding:8px;border-radius:50%;overflow:visible;color:rgba(0, 0, 0, 0.54);-webkit-transition:background-color 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:background-color 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;}.css-1yxmbwk::-moz-focus-inner{border-style:none;}.css-1yxmbwk.Mui-disabled{pointer-events:none;cursor:default;}@media print{.css-1yxmbwk{-webkit-print-color-adjust:exact;color-adjust:exact;}}.css-1yxmbwk:hover{background-color:rgba(0, 0, 0, 0.04);}@media (hover: none){.css-1yxmbwk:hover{background-color:transparent;}}.css-1yxmbwk.Mui-disabled{background-color:transparent;color:rgba(0, 0, 0, 0.26);}</style><button class="MuiButtonBase-root MuiIconButton-root MuiIconButton-sizeMedium css-1yxmbwk" tabindex="0" type="button"><style data-emotion="css 1ds1xfi">.css-1ds1xfi{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:1em;height:1em;display:inline-block;fill:currentColor;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;-webkit-transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;font-size:1.5rem;font-size:24px;color:#2E353B;}</style><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium css-1ds1xfi" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="MenuRoundedIcon"><path d="M4 18h16c.55 0 1-.45 1-1s-.45-1-1-1H4c-.55 0-1 .45-1 1s.45 1 1 1zm0-5h16c.55 0 1-.45 1-1s-.45-1-1-1H4c-.55 0-1 .45-1 1s.45 1 1 1zM3 7c0 .55.45 1 1 1h16c.55 0 1-.45 1-1s-.45-1-1-1H4c-.55 0-1 .45-1 1z"></path></svg></button></div></div></header><main class="MuiBox-root css-0"><style data-emotion="css 1srlm4o">.css-1srlm4o{margin-top:128px;margin-bottom:128px;max-width:1024px;margin-left:auto;margin-right:auto;background-color:#FFFFFF;border-radius:20px;}@media (min-width:0px){.css-1srlm4o{padding:16px;}}@media (min-width:600px){.css-1srlm4o{padding:24px 32px;}}</style><div class="MuiBox-root css-1srlm4o"><a href="/2023/sessions/"><style data-emotion="css mwfgnf">.css-mwfgnf{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin-bottom:40px;color:#728393;}.css-mwfgnf:hover{color:#2E353B;-webkit-text-decoration:underline;text-decoration:underline;}</style><div class="MuiBox-root css-mwfgnf"><style data-emotion="css vubbuv">.css-vubbuv{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:1em;height:1em;display:inline-block;fill:currentColor;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;-webkit-transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;font-size:1.5rem;}</style><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium css-vubbuv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="ArrowBackIosNewIcon"><path d="M17.77 3.77 16 2 6 12l10 10 1.77-1.77L9.54 12z"></path></svg><style data-emotion="css we1zyz">.css-we1zyz{margin:0;font-size:18px;line-height:150%;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;letter-spacing:0.01071em;color:#728393;font-family:'__Poppins_bfe252','__Poppins_Fallback_bfe252',Helvetica Neue,Arial,Hiragino Kaku Gothic ProN,Hiragino Sans,Meiryo,sans-serif;}@media (max-width:599.95px){.css-we1zyz{font-size:14px;}}.css-we1zyz:hover{color:#2E353B;}</style><p class="MuiTypography-root MuiTypography-body2 css-we1zyz">セッション一覧へ戻る</p></div></a><style data-emotion="css 1nqtyd5">.css-1nqtyd5{margin:0;font-size:50px;font-weight:500;margin-bottom:40px;font-family:"Roboto","Helvetica","Arial",sans-serif;line-height:1.2;letter-spacing:-0.00833em;color:#2E353B;font-family:'__Poppins_bfe252','__Poppins_Fallback_bfe252',Helvetica Neue,Arial,Hiragino Kaku Gothic ProN,Hiragino Sans,Meiryo,sans-serif;}@media (max-width:599.95px){.css-1nqtyd5{font-size:24px;margin-bottom:16px;}}</style><h2 class="MuiTypography-root MuiTypography-h2 css-1nqtyd5">Goのデバッグ用ロガーの開発を通して得た, デバッグとgoパッケージに関する知見</h2><style data-emotion="css oy1fef">.css-oy1fef{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;gap:8px;margin-bottom:24px;}</style><div class="MuiBox-root css-oy1fef"><style data-emotion="css 7rwzu3">.css-7rwzu3{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;background-color:#EF5DA8;border-radius:2px;padding:2px 4px;width:-webkit-fit-content;width:-moz-fit-content;width:fit-content;}</style><div class="MuiBox-root css-7rwzu3"><style data-emotion="css 1c0pdim">.css-1c0pdim{margin:0;font-size:12px;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;line-height:1.66;letter-spacing:0.03333em;color:#FFFFFF;font-family:'__Poppins_bfe252','__Poppins_Fallback_bfe252',Helvetica Neue,Arial,Hiragino Kaku Gothic ProN,Hiragino Sans,Meiryo,sans-serif;}@media (max-width:599.95px){.css-1c0pdim{font-size:10px;}}</style><span class="MuiTypography-root MuiTypography-caption css-1c0pdim">Room A : A11-S</span></div><style data-emotion="css 1iwn1vi">.css-1iwn1vi{margin:0;font-size:18px;line-height:150%;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;letter-spacing:0.01071em;color:#2E353B;font-family:'__Poppins_bfe252','__Poppins_Fallback_bfe252',Helvetica Neue,Arial,Hiragino Kaku Gothic ProN,Hiragino Sans,Meiryo,sans-serif;white-space:pre-wrap;}@media (max-width:599.95px){.css-1iwn1vi{font-size:14px;}}</style><p class="MuiTypography-root MuiTypography-body2 css-1iwn1vi">[Elevator Pitch]
Goでデバッグをする場合, 基本的にはDelve, GDB, ロギングの3択になります. DelveやGDBによるデバッグは便利ですが複数の変数情報を高速に得ることは困難であり, この用途にはロギングが適しています. しかし, デバッグ用に追加したロギング用のコードを消し忘れ, 実行速度の低下や業務用のコードにおける機密情報のログ出力等の問題を引き起こす可能性があります. これらの問題に対処するべく, 私はGoの静的解析および動的解析によって変数情報等を表示可能で, コミット時に自動的に削除されるデバッグ用のロガーdlを開発しました. 本セッションでは, 前述したGoにおける3種類のデバッグ方法の利点および欠点ならびにdlの開発を通して得たgo/ast等のgoパッケージに関する知見をご紹介します.

[Main Description]
開発において, 想定外の挙動をした際にデバッグをした経験がある方は多いのではないでしょうか? Goでデバッグをする場合, 基本的にはDelve[1], GDB[2], ロギングの3択になります. Delve[1]はサードパーティー製のGo用デバッガであり, 実行時の変数やスタック情報の表示や上書き, goroutineの情報取得等ができます. また, リモードデバッグを有効にすることで, VS CodeやGoLandなどのエディタやIDEに組み込んでGUI上でデバッグすることもできるため, 開発時に重宝します. GDB[2]はDelve[1]と似たデバッガで, gef[5]やpeda[4], pwndbg[6]等のGDBスクリプトにより, 低レイヤを対象としたデバッグを円滑に行うことができます. しかし, Go Blogの記事[3]に記載されているように, Goプログラムの構造を理解していないため誤った結果を表示する場合もあります. また, Delve[1]やGDB[2]はある1点の状態を詳しく得ることは得意ですが, 複数の変数情報等をまとめて高速に得ることは不得手です. したがって, 手軽に複数の変数情報等をまとめて高速に得る用途にはロギングが適しています.

Goのロギングには, builtinパッケージのpanic, print, println, fmtパッケージやlogパッケージの各種関数およびメソッド, サードパーティー製のglog[7], Logrus[8], zap[9]等のロガーが利用できます. また, logr[10]が提供するinterfaceを満たすロガーを利用することで, それぞれのロガーを手軽に切り替えることもできます. これにより, Delve[1]やGDB[2]と違い, 複数の変数情報等をまとめて高速に得ることができます. しかし, デバッグ用に追加したロギング用のコードを消し忘れ, 実行速度の低下や業務用のコードにおける機密情報のログ出力等の問題を引き起こす可能性があります. 実際に, 私もインターンシップ先のリポジトリに対して余分なロギング用のコードを追加し, レビュー漏れで本番コードに紛れ込んでしまった経験があります．

そこで, 私はGoの静的解析と動的解析によって変数情報等を表示でき，コミット時に自動的に削除されるデバッグ用のロガーdl( <a href="https://github.com/task4233/dl" target="_blank" rel="noopener noreferrer" style="color:#0078F9;text-decoration:underline">https://github.com/task4233/dl</a> )を開発しました. Design Docsはこちら( <a href="http://bit.ly/3XGdtyF" target="_blank" rel="noopener noreferrer" style="color:#0078F9;text-decoration:underline">http://bit.ly/3XGdtyF</a> )です. dlは変数とその型情報, 変数が利用されているコードの行数を表示する機能とコミット時に自動的に削除される機能を提供します. これらの機能は, Goのgo/token, go/parser, go/astパッケージ等を用いた静的解析やruntimeパッケージを用いた動的解析を活用することで実現しています. また, dlは前述したlogrのinterfaceを満たしているロガーであればラップすることができ, 既存のロガーを変更することなく容易に導入することができます. 私が調査した中では, これらの機能を全て備えたロガーは他に存在しませんでした(2023/01/30現在).

本セッションでは, 前述したGoにおける3種類のデバッグ方法の利点および欠点ならびにdlの開発を通して得たgo/ast等のgoパッケージに関する知見をご紹介します. 過去のGo ConferenceでGDB[2]に関する講演[11]がありましたが, これとは異なる切り口の内容なので差分はあると考えています.

[1] go-delve/delve: <a href="https://github.com/go-delve/delve" target="_blank" rel="noopener noreferrer" style="color:#0078F9;text-decoration:underline">https://github.com/go-delve/delve</a> 
[2] GDB: The GNU Project Debugger: <a href="https://www.sourceware.org/gdb/" target="_blank" rel="noopener noreferrer" style="color:#0078F9;text-decoration:underline">https://www.sourceware.org/gdb/</a> 
[3] Debugging Go Code with GDB: <a href="https://go.dev/doc/gdb" target="_blank" rel="noopener noreferrer" style="color:#0078F9;text-decoration:underline">https://go.dev/doc/gdb</a> 
[4] hugsy/gef: <a href="https://github.com/hugsy/gef" target="_blank" rel="noopener noreferrer" style="color:#0078F9;text-decoration:underline">https://github.com/hugsy/gef</a> 
[5] longld/peda: <a href="https://github.com/longld/peda" target="_blank" rel="noopener noreferrer" style="color:#0078F9;text-decoration:underline">https://github.com/longld/peda</a> 
[6] pwndbg/pwndbg: <a href="https://github.com/pwndbg/pwndbg" target="_blank" rel="noopener noreferrer" style="color:#0078F9;text-decoration:underline">https://github.com/pwndbg/pwndbg</a> 
[7] golang/glog: <a href="https://github.com/golang/glog" target="_blank" rel="noopener noreferrer" style="color:#0078F9;text-decoration:underline">https://github.com/golang/glog</a> 
[8] Sirupsen/logrus: <a href="https://github.com/Sirupsen/logrus" target="_blank" rel="noopener noreferrer" style="color:#0078F9;text-decoration:underline">https://github.com/Sirupsen/logrus</a> 
[9] uber-go/zap: <a href="https://github.com/uber-go/zap/" target="_blank" rel="noopener noreferrer" style="color:#0078F9;text-decoration:underline">https://github.com/uber-go/zap/</a> 
[10] go-logr/logr: <a href="https://github.com/go-logr/logr" target="_blank" rel="noopener noreferrer" style="color:#0078F9;text-decoration:underline">https://github.com/go-logr/logr</a> 
[11] Debugging Go Code with GDB:<a href="https://speakerdeck.com/kaneshin/debugging-go-code-with-gdb" target="_blank" rel="noopener noreferrer" style="color:#0078F9;text-decoration:underline">https://speakerdeck.com/kaneshin/debugging-go-code-with-gdb</a>
</p><style data-emotion="css k008qs">.css-k008qs{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}</style><div class="MuiBox-root css-k008qs"><style data-emotion="css 1utx3w7">.css-1utx3w7{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;gap:4px;}</style><div class="MuiBox-root css-1utx3w7"><style data-emotion="css 605szw">.css-605szw{margin:0;font-size:12px;line-height:120%;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;letter-spacing:0.00938em;color:#728393;font-family:'__Poppins_bfe252','__Poppins_Fallback_bfe252',Helvetica Neue,Arial,Hiragino Kaku Gothic ProN,Hiragino Sans,Meiryo,sans-serif;}@media (max-width:599.95px){.css-605szw{font-size:11px;}}</style><h6 class="MuiTypography-root MuiTypography-subtitle1 css-605szw">Challenge Session(20min)</h6></div><style data-emotion="css 1szr53z">.css-1szr53z{-webkit-text-decoration:underline;text-decoration:underline;text-decoration-color:rgba(25, 118, 210, 0.4);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;gap:4px;margin-left:auto;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:#2E353B;-webkit-text-decoration:none;text-decoration:none;}.css-1szr53z:hover{text-decoration-color:inherit;}.css-1szr53z:hover{color:#728393;-webkit-text-decoration:underline;text-decoration:underline;}</style><style data-emotion="css 1gjdgar">.css-1gjdgar{margin:0;font-size:18px;line-height:150%;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;letter-spacing:0.01071em;color:#1976d2;font-family:'__Poppins_bfe252','__Poppins_Fallback_bfe252',Helvetica Neue,Arial,Hiragino Kaku Gothic ProN,Hiragino Sans,Meiryo,sans-serif;-webkit-text-decoration:underline;text-decoration:underline;text-decoration-color:rgba(25, 118, 210, 0.4);display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;gap:4px;margin-left:auto;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:#2E353B;-webkit-text-decoration:none;text-decoration:none;}@media (max-width:599.95px){.css-1gjdgar{font-size:14px;}}.css-1gjdgar:hover{text-decoration-color:inherit;}.css-1gjdgar:hover{color:#728393;-webkit-text-decoration:underline;text-decoration:underline;}</style><a class="MuiTypography-root MuiTypography-body2 MuiLink-root MuiLink-underlineAlways css-1gjdgar" href="http://www.google.com/calendar/event?action=TEMPLATE&amp;text=Goのデバッグ用ロガーの開発を通して得た, デバッグとgoパッケージに関する知見&amp;details=[Elevator Pitch]
Goでデバッグをする場合, 基本的にはDelve, GDB, ロギングの3択になります. DelveやGDBによるデバッグは便利ですが複数の変数情報を高速に得ることは困難であり, この用途にはロギングが適しています. しかし, デバッグ用に追加したロギング用のコードを消し忘れ, 実行速度の低下や業務用のコードにおける機密情報のログ出力等の問題を引き起こす可能性があります. これらの問題に対処するべく, 私はGoの静的解析および動的解析によって変数情報等を表示可能で, コミット時に自動的に削除されるデバッグ用のロガーdlを開発しました. 本セッションでは, 前述したGoにおける3種類のデバッグ方法の利点および欠点ならびにdlの開発を通して得たgo/ast等のgoパッケージに関する知見をご紹介します.

[Main Description]
開発において, 想定外の挙動をした際にデバッグをした経験がある方は多いのではないでしょうか? Goでデバッグをする場合, 基本的にはDelve[1], GDB[2], ロギングの3択になります. Delve[1]はサードパーティー製のGo用デバッガであり, 実行時の変数やスタック情報の表示や上書き, goroutineの情報取得等ができます. また, リモードデバッグを有効にすることで, VS CodeやGoLandなどのエディタやIDEに組み込んでGUI上でデバッグすることもできるため, 開発時に重宝します. GDB[2]はDelve[1]と似たデバッガで, gef[5]やpeda[4], pwndbg[6]等のGDBスクリプトにより, 低レイヤを対象としたデバッグを円滑に行うことができます. しかし, Go Blogの記事[3]に記載されているように, Goプログラムの構造を理解していないため誤った結果を表示する場合もあります. また, Delve[1]やGDB[2]はある1点の状態を詳しく得ることは得意ですが, 複数の変数情報等をまとめて高速に得ることは不得手です. したがって, 手軽に複数の変数情報等をまとめて高速に得る用途にはロギングが適しています.

Goのロギングには, builtinパッケージのpanic, print, println, fmtパッケージやlogパッケージの各種関数およびメソッド, サードパーティー製のglog[7], Logrus[8], zap[9]等のロガーが利用できます. また, logr[10]が提供するinterfaceを満たすロガーを利用することで, それぞれのロガーを手軽に切り替えることもできます. これにより, Delve[1]やGDB[2]と違い, 複数の変数情報等をまとめて高速に得ることができます. しかし, デバッグ用に追加したロギング用のコードを消し忘れ, 実行速度の低下や業務用のコードにおける機密情報のログ出力等の問題を引き起こす可能性があります. 実際に, 私もインターンシップ先のリポジトリに対して余分なロギング用のコードを追加し, レビュー漏れで本番コードに紛れ込んでしまった経験があります．

そこで, 私はGoの静的解析と動的解析によって変数情報等を表示でき，コミット時に自動的に削除されるデバッグ用のロガーdl( https://github.com/task4233/dl )を開発しました. Design Docsはこちら( http://bit.ly/3XGdtyF )です. dlは変数とその型情報, 変数が利用されているコードの行数を表示する機能とコミット時に自動的に削除される機能を提供します. これらの機能は, Goのgo/token, go/parser, go/astパッケージ等を用いた静的解析やruntimeパッケージを用いた動的解析を活用することで実現しています. また, dlは前述したlogrのinterfaceを満たしているロガーであればラップすることができ, 既存のロガーを変更することなく容易に導入することができます. 私が調査した中では, これらの機能を全て備えたロガーは他に存在しませんでした(2023/01/30現在).

本セッションでは, 前述したGoにおける3種類のデバッグ方法の利点および欠点ならびにdlの開発を通して得たgo/ast等のgoパッケージに関する知見をご紹介します. 過去のGo ConferenceでGDB[2]に関する講演[11]がありましたが, これとは異なる切り口の内容なので差分はあると考えています.

[1] go-delve/delve: https://github.com/go-delve/delve 
[2] GDB: The GNU Project Debugger: https://www.sourceware.org/gdb/ 
[3] Debugging Go Code with GDB: https://go.dev/doc/gdb 
[4] hugsy/gef: https://github.com/hugsy/gef 
[5] longld/peda: https://github.com/longld/peda 
[6] pwndbg/pwndbg: https://github.com/pwndbg/pwndbg 
[7] golang/glog: https://github.com/golang/glog 
[8] Sirupsen/logrus: https://github.com/Sirupsen/logrus 
[9] uber-go/zap: https://github.com/uber-go/zap/ 
[10] go-logr/logr: https://github.com/go-logr/logr 
[11] Debugging Go Code with GDB:https://speakerdeck.com/kaneshin/debugging-go-code-with-gdb
&amp;dates=20230602T160000/20230602T162000" target="_blank"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium css-vubbuv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="EventIcon"><path d="M17 12h-5v5h5v-5zM16 1v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-1V1h-2zm3 18H5V8h14v11z"></path></svg>Googleカレンダーへ追加</a></div></div><style data-emotion="css 1k76fv9">.css-1k76fv9{background-color:#F7F9FB;border-radius:12px;}@media (min-width:0px){.css-1k76fv9{padding:16px;}}@media (min-width:600px){.css-1k76fv9{padding:32px;}}</style><div class="MuiBox-root css-1k76fv9"><style data-emotion="css qrrc4a">.css-qrrc4a{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;gap:8px;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin-bottom:8px;}</style><div class="MuiBox-root css-qrrc4a"><style data-emotion="css sv0sk2">.css-sv0sk2{position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;width:40px;height:40px;font-family:"Roboto","Helvetica","Arial",sans-serif;font-size:1.25rem;line-height:1;border-radius:50%;overflow:hidden;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:60px;height:60px;border:1px solid rgba(0, 0, 0, 0.08);}</style><div class="MuiAvatar-root MuiAvatar-circular css-sv0sk2"><style data-emotion="css 1hy9t21">.css-1hy9t21{width:100%;height:100%;text-align:center;object-fit:cover;color:transparent;text-indent:10000px;}</style><img alt="Takashi Mima" src="https://sessionize.com/image/10ec-400o400o2-Rq1dfj5AXWHc2MsCBGd2yf.jpeg" class="MuiAvatar-img css-1hy9t21"/></div><style data-emotion="css 1821gv5">.css-1821gv5{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;gap:8px;}</style><div class="MuiBox-root css-1821gv5"><style data-emotion="css 1dhr4ct">.css-1dhr4ct{margin:0;font-size:20px;font-weight:700;font-family:"Roboto","Helvetica","Arial",sans-serif;line-height:1.235;letter-spacing:0.00735em;color:#2E353B;font-family:'__Poppins_bfe252','__Poppins_Fallback_bfe252',Helvetica Neue,Arial,Hiragino Kaku Gothic ProN,Hiragino Sans,Meiryo,sans-serif;}@media (max-width:599.95px){.css-1dhr4ct{font-size:16px;}}</style><h4 class="MuiTypography-root MuiTypography-h4 css-1dhr4ct">Takashi Mima</h4><h6 class="MuiTypography-root MuiTypography-subtitle1 css-605szw">Mercari, inc.</h6></div><style data-emotion="css 1mf7gxt">.css-1mf7gxt{-webkit-text-decoration:underline;text-decoration:underline;text-decoration-color:rgba(25, 118, 210, 0.4);color:#2E353B;margin-left:auto;-webkit-align-self:flex-start;-ms-flex-item-align:flex-start;align-self:flex-start;}.css-1mf7gxt:hover{text-decoration-color:inherit;}.css-1mf7gxt:hover{color:#728393;}</style><style data-emotion="css 1q1tr9h">.css-1q1tr9h{margin:0;color:#1976d2;font-family:'__Poppins_bfe252','__Poppins_Fallback_bfe252',Helvetica Neue,Arial,Hiragino Kaku Gothic ProN,Hiragino Sans,Meiryo,sans-serif;-webkit-text-decoration:underline;text-decoration:underline;text-decoration-color:rgba(25, 118, 210, 0.4);color:#2E353B;margin-left:auto;-webkit-align-self:flex-start;-ms-flex-item-align:flex-start;align-self:flex-start;}.css-1q1tr9h:hover{text-decoration-color:inherit;}.css-1q1tr9h:hover{color:#728393;}</style><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineAlways css-1q1tr9h" href="https://twitter.com/task4233" target="_blank"><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium css-vubbuv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="TwitterIcon"><path d="M22.46 6c-.77.35-1.6.58-2.46.69.88-.53 1.56-1.37 1.88-2.38-.83.5-1.75.85-2.72 1.05C18.37 4.5 17.26 4 16 4c-2.35 0-4.27 1.92-4.27 4.29 0 .34.04.67.11.98C8.28 9.09 5.11 7.38 3 4.79c-.37.63-.58 1.37-.58 2.15 0 1.49.75 2.81 1.91 3.56-.71 0-1.37-.2-1.95-.5v.03c0 2.08 1.48 3.82 3.44 4.21a4.22 4.22 0 0 1-1.93.07 4.28 4.28 0 0 0 4 2.98 8.521 8.521 0 0 1-5.33 1.84c-.34 0-.68-.02-1.02-.06C3.44 20.29 5.7 21 8.12 21 16 21 20.33 14.46 20.33 8.79c0-.19 0-.37-.01-.56.84-.6 1.56-1.36 2.14-2.23z"></path></svg></a></div><style data-emotion="css 1miib2e">.css-1miib2e{margin:0;font-size:18px;line-height:150%;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;letter-spacing:0.01071em;color:#2E353B;font-family:'__Poppins_bfe252','__Poppins_Fallback_bfe252',Helvetica Neue,Arial,Hiragino Kaku Gothic ProN,Hiragino Sans,Meiryo,sans-serif;}@media (max-width:599.95px){.css-1miib2e{font-size:14px;}}</style><p class="MuiTypography-root MuiTypography-body2 css-1miib2e">My interests are backend and security. So far, I have implemented [a demo of Terraform Provider with a new framework](<a href="https://github.com/task4233/terraform-plugin-framework-demo" target="_blank" rel="noopener noreferrer" style="color:#0078F9;text-decoration:underline">https://github.com/task4233/terraform-plugin-framework-demo</a>) and involved [SECCON Beginners](<a href="https://www.seccon.jp/2022/beginners/about-seccon-beginners.html" target="_blank" rel="noopener noreferrer" style="color:#0078F9;text-decoration:underline">https://www.seccon.jp/2022/beginners/about-seccon-beginners.html</a>). I am going to become a SWE next spring.</p></div></div></main><style data-emotion="css 1hjb12a">.css-1hjb12a{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:flex-end;-webkit-box-align:flex-end;-ms-flex-align:flex-end;align-items:flex-end;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;gap:4px;width:100%;padding:64px 16px 16px;margin-top:auto;}</style><div class="MuiBox-root css-1hjb12a"><img alt="gopher conductor" loading="lazy" width="84" height="92" decoding="async" data-nimg="1" style="color:transparent;min-width:0;object-fit:contain" src="/2023/_next/static/media/gopher-conductor.ba52d982.png"/><img alt="gopher drummer" loading="lazy" width="82" height="88" decoding="async" data-nimg="1" style="color:transparent;min-width:0;object-fit:contain" src="/2023/_next/static/media/gopher-drummer.3c6e8ddd.png"/><img alt="gopher trumpeter" loading="lazy" width="84" height="78" decoding="async" data-nimg="1" style="color:transparent;min-width:0;object-fit:contain" src="/2023/_next/static/media/gopher-trumpeter.bfa847ad.png"/><img alt="gopher pom pom" loading="lazy" width="60" height="56" decoding="async" data-nimg="1" style="color:transparent;min-width:0;object-fit:contain" src="/2023/_next/static/media/gopher-pom-pom.da0a023d.png"/><img alt="gopher flower blue" loading="lazy" width="85" height="78" decoding="async" data-nimg="1" style="color:transparent;min-width:0;object-fit:contain" src="/2023/_next/static/media/gopher-flower-blue.f910d37c.png"/></div><style data-emotion="css 1l9291m">.css-1l9291m{background-color:#F5F5F5;}</style><footer class="MuiBox-root css-1l9291m"><style data-emotion="css ycbz48">.css-ycbz48{max-width:1024px;margin-left:auto;margin-right:auto;padding-top:32px;padding-bottom:32px;border-bottom:solid 1px #E5E5E5;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;gap:24px;}@media (min-width:0px){.css-ycbz48{padding-left:16px;padding-right:16px;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}}@media (min-width:600px){.css-ycbz48{padding-left:36px;padding-right:36px;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;}}</style><div class="MuiBox-root css-ycbz48"><style data-emotion="css i9gxme">.css-i9gxme{-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;}</style><div class="MuiBox-root css-i9gxme"><style data-emotion="css deg97p">.css-deg97p{margin:0;font-size:20px;font-weight:700;font-family:"Roboto","Helvetica","Arial",sans-serif;line-height:1.235;letter-spacing:0.00735em;color:#2E353B;font-family:'__Poppins_bfe252','__Poppins_Fallback_bfe252',Helvetica Neue,Arial,Hiragino Kaku Gothic ProN,Hiragino Sans,Meiryo,sans-serif;margin-bottom:8px;}@media (max-width:599.95px){.css-deg97p{font-size:16px;}}</style><h4 class="MuiTypography-root MuiTypography-h4 css-deg97p">About</h4><style data-emotion="css 1ontqvh">.css-1ontqvh{list-style:none;margin:0;padding:0;position:relative;padding-top:8px;padding-bottom:8px;}</style><ul class="MuiList-root MuiList-padding css-1ontqvh"><style data-emotion="css 3zcl9c">.css-3zcl9c{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:start;-ms-flex-pack:start;-webkit-justify-content:flex-start;justify-content:flex-start;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;position:relative;-webkit-text-decoration:none;text-decoration:none;width:100%;box-sizing:border-box;text-align:left;padding-top:8px;padding-bottom:8px;padding-left:16px;padding-right:16px;padding-left:0;padding-right:0;}.css-3zcl9c.Mui-focusVisible{background-color:rgba(0, 0, 0, 0.12);}.css-3zcl9c.Mui-selected{background-color:rgba(25, 118, 210, 0.08);}.css-3zcl9c.Mui-selected.Mui-focusVisible{background-color:rgba(25, 118, 210, 0.2);}.css-3zcl9c.Mui-disabled{opacity:0.38;}</style><li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding css-3zcl9c"><style data-emotion="css 133hxc9">.css-133hxc9{-webkit-text-decoration:underline;text-decoration:underline;text-decoration-color:rgba(25, 118, 210, 0.4);color:#2E353B;text-decoration-color:#2E353B;}.css-133hxc9:hover{text-decoration-color:inherit;}.css-133hxc9:hover{color:#82919D;text-decoration-color:#82919D;}</style><style data-emotion="css pq6skq">.css-pq6skq{margin:0;color:#1976d2;font-family:'__Poppins_bfe252','__Poppins_Fallback_bfe252',Helvetica Neue,Arial,Hiragino Kaku Gothic ProN,Hiragino Sans,Meiryo,sans-serif;-webkit-text-decoration:underline;text-decoration:underline;text-decoration-color:rgba(25, 118, 210, 0.4);color:#2E353B;text-decoration-color:#2E353B;}.css-pq6skq:hover{text-decoration-color:inherit;}.css-pq6skq:hover{color:#82919D;text-decoration-color:#82919D;}</style><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineAlways css-pq6skq" href="https://go.dev/conduct" target="_blank">Code of Conduct</a></li><li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding css-3zcl9c"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineAlways css-pq6skq" href="mailto:info@gocon.jp" target="_blank">INFO@GOCON.JP</a></li><li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding css-3zcl9c"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineAlways css-pq6skq" href="https://drive.google.com/file/d/1Xon1uyLT-810sxnkLMngmL67z68K3XJG/view" target="_blank">特定商取引法に基づく表記</a></li></ul></div><div class="MuiBox-root css-i9gxme"><h4 class="MuiTypography-root MuiTypography-h4 css-deg97p">Past Conferences</h4><ul class="MuiList-root MuiList-padding css-1ontqvh"><li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding css-3zcl9c"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineAlways css-pq6skq" href="https://gocon.jp/2022spring" target="_blank">2022 Spring</a></li><li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding css-3zcl9c"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineAlways css-pq6skq" href="https://gocon.jp/2021autumn" target="_blank">2021 Autumn</a></li><li class="MuiListItem-root MuiListItem-gutters MuiListItem-padding css-3zcl9c"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineAlways css-pq6skq" href="https://gocon.jp/2021spring" target="_blank">2021 Spring</a></li></ul></div></div><style data-emotion="css td7y8x">.css-td7y8x{max-width:1024px;margin-left:auto;margin-right:auto;padding-top:24px;padding-bottom:24px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;gap:16px;}@media (min-width:0px){.css-td7y8x{padding-left:16px;padding-right:16px;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}}@media (min-width:600px){.css-td7y8x{padding-left:36px;padding-right:36px;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}}</style><div class="MuiBox-root css-td7y8x"><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineAlways css-pq6skq" href="https://twitter.com/hashtag/gocon" target="_blank"><style data-emotion="css 1i27l4i">.css-1i27l4i{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;gap:8px;}</style><div class="MuiBox-root css-1i27l4i"><style data-emotion="css vubbuv">.css-vubbuv{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;width:1em;height:1em;display:inline-block;fill:currentColor;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;-webkit-transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;transition:fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;font-size:1.5rem;}</style><svg class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium css-vubbuv" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="TwitterIcon"><path d="M22.46 6c-.77.35-1.6.58-2.46.69.88-.53 1.56-1.37 1.88-2.38-.83.5-1.75.85-2.72 1.05C18.37 4.5 17.26 4 16 4c-2.35 0-4.27 1.92-4.27 4.29 0 .34.04.67.11.98C8.28 9.09 5.11 7.38 3 4.79c-.37.63-.58 1.37-.58 2.15 0 1.49.75 2.81 1.91 3.56-.71 0-1.37-.2-1.95-.5v.03c0 2.08 1.48 3.82 3.44 4.21a4.22 4.22 0 0 1-1.93.07 4.28 4.28 0 0 0 4 2.98 8.521 8.521 0 0 1-5.33 1.84c-.34 0-.68-.02-1.02-.06C3.44 20.29 5.7 21 8.12 21 16 21 20.33 14.46 20.33 8.79c0-.19 0-.37-.01-.56.84-.6 1.56-1.36 2.14-2.23z"></path></svg><span>#GOCON</span></div></a><style data-emotion="css 1kkt86i">.css-1kkt86i{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;gap:4px;}</style><div class="MuiBox-root css-1kkt86i"><style data-emotion="css 13968zk">.css-13968zk{margin:0;font-size:18px;line-height:150%;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;letter-spacing:0.01071em;color:#728393;font-family:'__Poppins_bfe252','__Poppins_Fallback_bfe252',Helvetica Neue,Arial,Hiragino Kaku Gothic ProN,Hiragino Sans,Meiryo,sans-serif;}@media (max-width:599.95px){.css-13968zk{font-size:14px;}}@media (min-width:0px){.css-13968zk{text-align:left;}}@media (min-width:600px){.css-13968zk{text-align:right;}}</style><p class="MuiTypography-root MuiTypography-body2 css-13968zk">Go Conference</p><style data-emotion="css ni76eq">.css-ni76eq{margin:0;font-size:12px;font-family:"Roboto","Helvetica","Arial",sans-serif;font-weight:400;line-height:1.66;letter-spacing:0.03333em;color:#728393;font-family:'__Poppins_bfe252','__Poppins_Fallback_bfe252',Helvetica Neue,Arial,Hiragino Kaku Gothic ProN,Hiragino Sans,Meiryo,sans-serif;}@media (max-width:599.95px){.css-ni76eq{font-size:10px;}}@media (min-width:0px){.css-ni76eq{text-align:left;}}@media (min-width:600px){.css-ni76eq{text-align:right;}}</style><span class="MuiTypography-root MuiTypography-caption css-ni76eq">The Go gopher was designed by<!-- --> <style data-emotion="css 1qa4byk">.css-1qa4byk{-webkit-text-decoration:underline;text-decoration:underline;text-decoration-color:rgba(25, 118, 210, 0.4);color:#728393;text-decoration-color:#728393;}.css-1qa4byk:hover{text-decoration-color:inherit;}.css-1qa4byk:hover{color:#A3AEB9;text-decoration-color:#A3AEB9;}</style><style data-emotion="css 1dqud4b">.css-1dqud4b{margin:0;color:#1976d2;font-family:'__Poppins_bfe252','__Poppins_Fallback_bfe252',Helvetica Neue,Arial,Hiragino Kaku Gothic ProN,Hiragino Sans,Meiryo,sans-serif;-webkit-text-decoration:underline;text-decoration:underline;text-decoration-color:rgba(25, 118, 210, 0.4);color:#728393;text-decoration-color:#728393;}.css-1dqud4b:hover{text-decoration-color:inherit;}.css-1dqud4b:hover{color:#A3AEB9;text-decoration-color:#A3AEB9;}</style><a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineAlways css-1dqud4b" href="http://reneefrench.blogspot.com/" target="_blank">Renée French</a>. Illustrations by<!-- --> <a class="MuiTypography-root MuiTypography-inherit MuiLink-root MuiLink-underlineAlways css-1dqud4b" href="https://twitter.com/tottie_designer" target="_blank">tottie</a>.</span></div></div></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"title":"Goのデバッグ用ロガーの開発を通して得た, デバッグとgoパッケージに関する知見","roomName":"Room A","sessionId":"A11-S","description":"[Elevator Pitch]\r\nGoでデバッグをする場合, 基本的にはDelve, GDB, ロギングの3択になります. DelveやGDBによるデバッグは便利ですが複数の変数情報を高速に得ることは困難であり, この用途にはロギングが適しています. しかし, デバッグ用に追加したロギング用のコードを消し忘れ, 実行速度の低下や業務用のコードにおける機密情報のログ出力等の問題を引き起こす可能性があります. これらの問題に対処するべく, 私はGoの静的解析および動的解析によって変数情報等を表示可能で, コミット時に自動的に削除されるデバッグ用のロガーdlを開発しました. 本セッションでは, 前述したGoにおける3種類のデバッグ方法の利点および欠点ならびにdlの開発を通して得たgo/ast等のgoパッケージに関する知見をご紹介します.\r\n\r\n[Main Description]\r\n開発において, 想定外の挙動をした際にデバッグをした経験がある方は多いのではないでしょうか? Goでデバッグをする場合, 基本的にはDelve[1], GDB[2], ロギングの3択になります. Delve[1]はサードパーティー製のGo用デバッガであり, 実行時の変数やスタック情報の表示や上書き, goroutineの情報取得等ができます. また, リモードデバッグを有効にすることで, VS CodeやGoLandなどのエディタやIDEに組み込んでGUI上でデバッグすることもできるため, 開発時に重宝します. GDB[2]はDelve[1]と似たデバッガで, gef[5]やpeda[4], pwndbg[6]等のGDBスクリプトにより, 低レイヤを対象としたデバッグを円滑に行うことができます. しかし, Go Blogの記事[3]に記載されているように, Goプログラムの構造を理解していないため誤った結果を表示する場合もあります. また, Delve[1]やGDB[2]はある1点の状態を詳しく得ることは得意ですが, 複数の変数情報等をまとめて高速に得ることは不得手です. したがって, 手軽に複数の変数情報等をまとめて高速に得る用途にはロギングが適しています.\r\n\r\nGoのロギングには, builtinパッケージのpanic, print, println, fmtパッケージやlogパッケージの各種関数およびメソッド, サードパーティー製のglog[7], Logrus[8], zap[9]等のロガーが利用できます. また, logr[10]が提供するinterfaceを満たすロガーを利用することで, それぞれのロガーを手軽に切り替えることもできます. これにより, Delve[1]やGDB[2]と違い, 複数の変数情報等をまとめて高速に得ることができます. しかし, デバッグ用に追加したロギング用のコードを消し忘れ, 実行速度の低下や業務用のコードにおける機密情報のログ出力等の問題を引き起こす可能性があります. 実際に, 私もインターンシップ先のリポジトリに対して余分なロギング用のコードを追加し, レビュー漏れで本番コードに紛れ込んでしまった経験があります．\r\n\r\nそこで, 私はGoの静的解析と動的解析によって変数情報等を表示でき，コミット時に自動的に削除されるデバッグ用のロガーdl( https://github.com/task4233/dl )を開発しました. Design Docsはこちら( http://bit.ly/3XGdtyF )です. dlは変数とその型情報, 変数が利用されているコードの行数を表示する機能とコミット時に自動的に削除される機能を提供します. これらの機能は, Goのgo/token, go/parser, go/astパッケージ等を用いた静的解析やruntimeパッケージを用いた動的解析を活用することで実現しています. また, dlは前述したlogrのinterfaceを満たしているロガーであればラップすることができ, 既存のロガーを変更することなく容易に導入することができます. 私が調査した中では, これらの機能を全て備えたロガーは他に存在しませんでした(2023/01/30現在).\r\n\r\n本セッションでは, 前述したGoにおける3種類のデバッグ方法の利点および欠点ならびにdlの開発を通して得たgo/ast等のgoパッケージに関する知見をご紹介します. 過去のGo ConferenceでGDB[2]に関する講演[11]がありましたが, これとは異なる切り口の内容なので差分はあると考えています.\r\n\r\n[1] go-delve/delve: https://github.com/go-delve/delve \r\n[2] GDB: The GNU Project Debugger: https://www.sourceware.org/gdb/ \r\n[3] Debugging Go Code with GDB: https://go.dev/doc/gdb \r\n[4] hugsy/gef: https://github.com/hugsy/gef \r\n[5] longld/peda: https://github.com/longld/peda \r\n[6] pwndbg/pwndbg: https://github.com/pwndbg/pwndbg \r\n[7] golang/glog: https://github.com/golang/glog \r\n[8] Sirupsen/logrus: https://github.com/Sirupsen/logrus \r\n[9] uber-go/zap: https://github.com/uber-go/zap/ \r\n[10] go-logr/logr: https://github.com/go-logr/logr \r\n[11] Debugging Go Code with GDB:https://speakerdeck.com/kaneshin/debugging-go-code-with-gdb\r\n","sessionLevel":null,"sessionType":"Challenge Session(20min)","addEventToCalendarLink":"http://www.google.com/calendar/event?action=TEMPLATE\u0026text=Goのデバッグ用ロガーの開発を通して得た, デバッグとgoパッケージに関する知見\u0026details=[Elevator Pitch]\r\nGoでデバッグをする場合, 基本的にはDelve, GDB, ロギングの3択になります. DelveやGDBによるデバッグは便利ですが複数の変数情報を高速に得ることは困難であり, この用途にはロギングが適しています. しかし, デバッグ用に追加したロギング用のコードを消し忘れ, 実行速度の低下や業務用のコードにおける機密情報のログ出力等の問題を引き起こす可能性があります. これらの問題に対処するべく, 私はGoの静的解析および動的解析によって変数情報等を表示可能で, コミット時に自動的に削除されるデバッグ用のロガーdlを開発しました. 本セッションでは, 前述したGoにおける3種類のデバッグ方法の利点および欠点ならびにdlの開発を通して得たgo/ast等のgoパッケージに関する知見をご紹介します.\r\n\r\n[Main Description]\r\n開発において, 想定外の挙動をした際にデバッグをした経験がある方は多いのではないでしょうか? Goでデバッグをする場合, 基本的にはDelve[1], GDB[2], ロギングの3択になります. Delve[1]はサードパーティー製のGo用デバッガであり, 実行時の変数やスタック情報の表示や上書き, goroutineの情報取得等ができます. また, リモードデバッグを有効にすることで, VS CodeやGoLandなどのエディタやIDEに組み込んでGUI上でデバッグすることもできるため, 開発時に重宝します. GDB[2]はDelve[1]と似たデバッガで, gef[5]やpeda[4], pwndbg[6]等のGDBスクリプトにより, 低レイヤを対象としたデバッグを円滑に行うことができます. しかし, Go Blogの記事[3]に記載されているように, Goプログラムの構造を理解していないため誤った結果を表示する場合もあります. また, Delve[1]やGDB[2]はある1点の状態を詳しく得ることは得意ですが, 複数の変数情報等をまとめて高速に得ることは不得手です. したがって, 手軽に複数の変数情報等をまとめて高速に得る用途にはロギングが適しています.\r\n\r\nGoのロギングには, builtinパッケージのpanic, print, println, fmtパッケージやlogパッケージの各種関数およびメソッド, サードパーティー製のglog[7], Logrus[8], zap[9]等のロガーが利用できます. また, logr[10]が提供するinterfaceを満たすロガーを利用することで, それぞれのロガーを手軽に切り替えることもできます. これにより, Delve[1]やGDB[2]と違い, 複数の変数情報等をまとめて高速に得ることができます. しかし, デバッグ用に追加したロギング用のコードを消し忘れ, 実行速度の低下や業務用のコードにおける機密情報のログ出力等の問題を引き起こす可能性があります. 実際に, 私もインターンシップ先のリポジトリに対して余分なロギング用のコードを追加し, レビュー漏れで本番コードに紛れ込んでしまった経験があります．\r\n\r\nそこで, 私はGoの静的解析と動的解析によって変数情報等を表示でき，コミット時に自動的に削除されるデバッグ用のロガーdl( https://github.com/task4233/dl )を開発しました. Design Docsはこちら( http://bit.ly/3XGdtyF )です. dlは変数とその型情報, 変数が利用されているコードの行数を表示する機能とコミット時に自動的に削除される機能を提供します. これらの機能は, Goのgo/token, go/parser, go/astパッケージ等を用いた静的解析やruntimeパッケージを用いた動的解析を活用することで実現しています. また, dlは前述したlogrのinterfaceを満たしているロガーであればラップすることができ, 既存のロガーを変更することなく容易に導入することができます. 私が調査した中では, これらの機能を全て備えたロガーは他に存在しませんでした(2023/01/30現在).\r\n\r\n本セッションでは, 前述したGoにおける3種類のデバッグ方法の利点および欠点ならびにdlの開発を通して得たgo/ast等のgoパッケージに関する知見をご紹介します. 過去のGo ConferenceでGDB[2]に関する講演[11]がありましたが, これとは異なる切り口の内容なので差分はあると考えています.\r\n\r\n[1] go-delve/delve: https://github.com/go-delve/delve \r\n[2] GDB: The GNU Project Debugger: https://www.sourceware.org/gdb/ \r\n[3] Debugging Go Code with GDB: https://go.dev/doc/gdb \r\n[4] hugsy/gef: https://github.com/hugsy/gef \r\n[5] longld/peda: https://github.com/longld/peda \r\n[6] pwndbg/pwndbg: https://github.com/pwndbg/pwndbg \r\n[7] golang/glog: https://github.com/golang/glog \r\n[8] Sirupsen/logrus: https://github.com/Sirupsen/logrus \r\n[9] uber-go/zap: https://github.com/uber-go/zap/ \r\n[10] go-logr/logr: https://github.com/go-logr/logr \r\n[11] Debugging Go Code with GDB:https://speakerdeck.com/kaneshin/debugging-go-code-with-gdb\r\n\u0026dates=20230602T160000/20230602T162000","speaker":{"fullName":"Takashi Mima","profilePicture":"https://sessionize.com/image/10ec-400o400o2-Rq1dfj5AXWHc2MsCBGd2yf.jpeg","bio":"My interests are backend and security. So far, I have implemented [a demo of Terraform Provider with a new framework](https://github.com/task4233/terraform-plugin-framework-demo) and involved [SECCON Beginners](https://www.seccon.jp/2022/beginners/about-seccon-beginners.html). I am going to become a SWE next spring.","tagLine":"Mercari, inc.","twitterLink":"https://twitter.com/task4233"}},"__N_SSG":true},"page":"/sessions/[id]","query":{"id":"A11-S"},"buildId":"a1OLcSOxYttiSaOLVVhcn","assetPrefix":"/2023","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>